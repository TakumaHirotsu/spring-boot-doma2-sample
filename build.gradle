plugins {
    id "idea"
    id "org.springframework.boot" version "${springBootVersion}" apply false
    id "io.spring.dependency-management" version "${dependencyManagementVersion}" apply false
    id "org.seasar.doma.compile" version "1.1.0" apply false
    id "com.google.cloud.tools.jib" version "3.2.1" apply false
    id "com.avast.gradle.docker-compose" version "0.16.11" apply false
    id "com.diffplug.spotless" version "${spotlessVersion}"
}

apply plugin: "docker-compose"
apply plugin: com.sample.CodeGenPlugin

subprojects {
    apply plugin: "java"
    apply plugin: "groovy"
    apply plugin: "org.springframework.boot"
    apply plugin: "io.spring.dependency-management"
    apply plugin: "com.diffplug.spotless"

    repositories {
        mavenCentral()
        mavenLocal()
        maven { url "https://repo.spring.io/release" }
        maven { url "https://jaspersoft.jfrog.io/jaspersoft/third-party-ce-artifacts/" }
    }

    spotless {
        java {
            googleJavaFormat()
            trimTrailingWhitespace()
            endWithNewline()
        }

        groovy {
            trimTrailingWhitespace()
            indentWithSpaces(4)
            endWithNewline()
        }

        groovyGradle {
            target "*.gradle", "**/*.gradle"
            trimTrailingWhitespace()
            indentWithSpaces(4)
            endWithNewline()
        }

        format "misc", {
            target "**/*.md", "**/*.yml"
            trimTrailingWhitespace()
            indentWithSpaces(2)
            endWithNewline()
        }

        lineEndings "UNIX"
    }

    sourceCompatibility = "17"
    [compileJava, compileTestJava, compileGroovy, compileTestGroovy]*.options*.encoding = "UTF-8"
    [compileJava, compileTestJava, compileGroovy, compileTestGroovy]*.options*.compilerArgs = ["-Xlint:all"]

    dependencies {
        compileOnly "org.projectlombok:lombok"
        annotationProcessor "org.projectlombok:lombok"
        testCompileOnly "org.projectlombok:lombok"
        testAnnotationProcessor "org.projectlombok:lombok"

        testImplementation "org.springframework.security:spring-security-test"
        testImplementation "org.springframework.boot:spring-boot-starter-test"
        testImplementation "org.spockframework:spock-spring:${spockVersion}"
        testImplementation "org.codehaus.groovy:groovy-all:3.0.12"

        runtimeOnly "org.springframework.boot:spring-boot-properties-migrator"
    }

    test {
        useJUnitPlatform()
        testLogging {
            events "passed", "skipped", "failed"
        }
    }

    compileJava.dependsOn "spotlessApply"
}

codegen {
    domainProjectName = "sample-domain"
    webProjectName = "sample-web-admin"

    commonDtoPackageName = "com.sample.domain.dto.common"
    daoPackageName = "com.sample.domain.dao"
    dtoPackageName = "com.sample.domain.dto"
    repositoryPackageName = "com.sample.domain.repository"
    servicePackageName = "com.sample.domain.service"
    commonServicePackageName = "com.sample.domain.service"
    exceptionPackageName = "com.sample.domain.exception"
    webBasePackageName = "com.sample.web.base"
    baseValidatorPackageName = "com.sample.domain.validator"
    baseControllerPackageName = "com.sample.web.base.controller.html"
    controllerPackageName = "com.sample.web.admin.controller.html"
}
